---
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog');
const posts = allPosts
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 3);

const iconPaths: Record<string, string> = {
  microphone:
    'M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z',
  music:
    'M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3',
  bolt: 'M13 10V3L4 14h7v7l9-11h-7z',
};

const gradients: Record<number, string> = {
  0: 'from-quaternary to-secondary',
  1: 'from-secondary to-quaternary',
  2: 'from-quaternary/80 to-secondary/80',
};
---

<section class="w-full max-w-7xl mx-auto px-6 py-28">
  <div class="text-center mb-16">
    <h2 class="text-4xl md:text-5xl font-medium tracking-tighter text-pri mb-2">
      Blog & Recursos
    </h2>
    <p class="text-sec text-lg tracking-tighter">
      Tips, tutoriales y novedades sobre producción musical e IA
    </p>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
    {posts.map((post, i) => (
      <a href={`/blogs/${post.id}`} target="_blank" rel="noopener noreferrer" class="block">
        <article
          class="bg-tertiary border border-border-pri rounded-xl overflow-hidden hover:border-quaternary/50 transition-all group cursor-pointer h-full flex flex-col"
        >
          <div class="relative h-48 overflow-hidden">
            {post.data.image ? (
              <img
                src={post.data.image}
                alt={post.data.title}
                class="w-full h-full object-cover"
              />
            ) : (
              <>
                <div class={`absolute inset-0 bg-linear-to-br ${gradients[i] ?? gradients[0]}`}></div>
                <div class="absolute inset-0 flex items-center justify-center">
                  <svg
                    class="w-16 h-16 text-pri/20"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d={iconPaths[post.data.icon] ?? iconPaths.bolt}
                    />
                  </svg>
                </div>
              </>
            )}
            <span
              class:list={[
                'absolute top-4 left-4 text-pri text-xs font-semibold px-3 py-1 rounded-full',
                post.data.categoryColor === 'secondary' ? 'bg-secondary' : 'bg-quaternary',
              ]}
            >
              {post.data.category}
            </span>
          </div>

          <div class="p-6 flex flex-col flex-1">
            <div class="flex items-center gap-2 text-sec text-sm mb-3">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path
                  fill-rule="evenodd"
                  d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z"
                  clip-rule="evenodd"
                />
              </svg>
              <time datetime={post.data.date.toISOString()}>
                {post.data.date.toLocaleDateString('es-ES', {
                  day: 'numeric',
                  month: 'long',
                  year: 'numeric',
                })}
              </time>
            </div>

            <h3 class="text-xl font-bold text-pri mb-3 group-hover:text-quaternary transition-colors">
              {post.data.title}
            </h3>

            <p class="text-sec text-sm leading-relaxed mb-4 flex-1">
              {post.data.description}
            </p>

            <div class="flex items-center text-quaternary text-sm font-semibold">
              Leer más
              <svg class="w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </div>
          </div>
        </article>
      </a>
    ))}
  </div>

  <!-- CTA para ver más artículos -->
  <div class="text-center">
    <a
      href="/blog"
      target="_blank"
      rel="noopener noreferrer"
      class="inline-flex items-center gap-2 px-8 py-4 bg-quaternary text-pri font-semibold rounded-full hover:brightness-110 transition-all"
    >
      Ver todos los artículos
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
      </svg>
    </a>
  </div>
</section>