---
import FlacDownloader from "../../assets/logos/Flac_Downloader.svg";
import Mp3Downloader from "../../assets/logos/Mp3_Downloader.svg";
import Resourzly from "../../assets/logos/Resourzly.svg";
import VipRemixer from "../../assets/logos/Vip_Remixer.svg";
import VocalRemover from "../../assets/logos/Vocal_Remover.svg";
import WShare from "../../assets/logos/wShare.svg";

const logos = [
  { Component: WShare, label: "wShare", link: "https://wshare.cc" },
  {
    Component: VipRemixer,
    label: "Vip Remixer",
    link: "https://vipremixer.winkermind.com",
  },
  { Component: Resourzly, label: "Resourzly", link: "https://resourzly.com" },
  {
    Component: FlacDownloader,
    label: "Flac Downloader",
    link: "https://flacdownloader.com",
  },
  {
    Component: Mp3Downloader,
    label: "Mp3 Downloader",
    link: "https://mp3downloader.cc",
  },
  {
    Component: VocalRemover,
    label: "Vocal Remover",
    link: "https://vocalremover.winkermind.com",
  },
];
---

<section
  class="flex flex-col items-center justify-center gap-4 py-8 w-full overflow-hidden"
>
  <h2
    class="text-sm font-bold text-center text-sec tracking-wide uppercase pt-8"
  >
    NUESTROS PROYECTOS
  </h2>

  <div class="relative w-full">
    <div
      class="absolute left-0 top-0 bottom-0 w-32 bg-linear-to-r from-primary to-transparent z-10 pointer-events-none"
    >
    </div>
    <div
      class="absolute right-0 top-0 bottom-0 w-32 bg-linear-to-l from-primary to-transparent z-10 pointer-events-none"
    >
    </div>

    <div class="flex gap-12 animate-scroll">
      {
        [...logos, ...logos].map(({ Component, label, link }) => (
          <a
            href={link}
            target="_blank"
            rel="noopener noreferrer"
            class="px-6 py-4 rounded-xl transition-all duration-300 flex items-center justify-center logo-tile shrink-0"
          >
            <Component class="h-8 w-auto" aria-hidden="true" />
            <span class="sr-only">{label}</span>
          </a>
        ))
      }
    </div>
  </div>
</section>

<style>
  .animate-scroll {
    animation: scroll 40s linear infinite;
  }

  .animate-scroll:hover {
    animation-play-state: paused;
    cursor: pointer;
  }

  .logo-tile {
    opacity: 0.6;
  }

  .logo-tile :global(svg) {
    filter: grayscale(1) saturate(0.6);
    transition:
      filter 200ms ease,
      opacity 200ms ease,
      transform 200ms ease;
  }

  .logo-tile:hover {
    opacity: 1;
  }

  .logo-tile:hover :global(svg) {
    filter: none;
    transform: translateY(-1px);
  }
</style>

<script>
  function initCarousel() {
    const carousel = document.querySelector(".animate-scroll") as HTMLElement;
    if (!carousel) return;

    const items = carousel.children;
    const totalItems = items.length;
    const halfItems = totalItems / 2;

    // Calcular ancho exacto de la primera mitad incluyendo gaps
    const computedStyle = getComputedStyle(carousel);
    const gap = parseFloat(computedStyle.gap) || 0;

    let halfWidth = 0;
    for (let i = 0; i < halfItems; i++) {
      halfWidth += (items[i] as HTMLElement).offsetWidth;
    }
    halfWidth += gap * halfItems; // gaps entre elementos + gap final

    carousel.style.setProperty("--scroll-width", `-${halfWidth}px`);
  }

  // Ejecutar después de que el DOM esté listo y las fuentes cargadas
  if (document.readyState === "complete") {
    initCarousel();
  } else {
    window.addEventListener("load", initCarousel);
  }
</script>

<style is:global>
  @keyframes scroll {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(var(--scroll-width, -50%));
    }
  }
</style>
